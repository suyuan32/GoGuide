import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,o as n,d as i}from"./app-dZGD8VFP.js";const l={},e=i(`<h2 id="什么是闭包" tabindex="-1"><a class="header-anchor" href="#什么是闭包"><span>什么是闭包?</span></a></h2><div class="hint-container info"><p class="hint-container-title">什么是闭包?</p><p>闭包是由函数和与其相关的引用环境组合而成的实体。简单来说，闭包就是一个引用了作用域之外的变量的函数（Func），该函数的存在时间可以超过创建他的作用域。</p><p>例子</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">package</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">fmt</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	count</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		i</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"> // 初始化函数内变量</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">		return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">			i</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ++</span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;"> // 函数内变量加 1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">			return</span><span style="color:#24292E;--shiki-dark:#E06C75;"> i</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	fmt</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Println</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">count</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	fmt</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Println</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">count</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// 结果</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// 1</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// 2</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们会注意到 <code>i</code> 是 <code>count</code> 的局部变量，执行两次函数感觉上应该是都输出 <code>1</code>， 实际上输出的是 <code>1， 2</code>， 原因是在赋值时 <code>count</code> 保留着对 <code>i</code> 的指针，因此 <code>i</code> 在逃逸分析后被保留，没有随着函数的执行完毕而结束。<strong>如果函数没有赋值给变量，则执行多次结果会保持不变。</strong></p></div><h2 id="使用场景" tabindex="-1"><a class="header-anchor" href="#使用场景"><span>使用场景</span></a></h2><h3 id="中间件" tabindex="-1"><a class="header-anchor" href="#中间件"><span>中间件</span></a></h3><p>我们在定义 web 中间件时经常会看到以下形式的代码:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> makeHandler</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">fn</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">http</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ResponseWriter</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">*</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">http</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Request</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">string</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)) </span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">http</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">HandlerFunc</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">w</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> http</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">ResponseWriter</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">r</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">http</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;">Request</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">        m</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#24292E;--shiki-dark:#E06C75;"> validPath</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">FindStringSubmatch</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">r</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">URL</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#24292E;--shiki-dark:#E06C75;">Path</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">        if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> m</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ==</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> nil</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">            http</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">NotFound</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">w</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">r</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">            return</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        fn</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">w</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">r</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">m</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="color:#005CC5;--shiki-dark:#D19A66;">2</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">]) </span><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// 如果没问题则继续执行 fn</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到, 我们返回了一个 <code>http.HandlerFunc</code>, 这个函数里面调用了 fn, 这样的话我们就可以实现链式操作，既执行了中间件代码，又可以继续执行函数，非常方便。</p><h2 id="状态共享" tabindex="-1"><a class="header-anchor" href="#状态共享"><span>状态共享</span></a></h2><p>闭包可以用来共享多次执行函数的状态， 常见的例子是迭代器:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">package</span><span style="color:#6F42C1;--shiki-dark:#E5C07B;"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">import</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;</span><span style="color:#6F42C1;--shiki-dark:#98C379;">fmt</span><span style="color:#032F62;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> main</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	num</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> []</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">{</span><span style="color:#005CC5;--shiki-dark:#D19A66;">1</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">2</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">3</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">4</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	iterator</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">arr</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> []</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">([]</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) (</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">bool</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		i</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> -</span><span style="color:#005CC5;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">		return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">arr</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> []</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) (</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">bool</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">			i</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> ++</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">			if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> i</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> len</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">arr</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">				return</span><span style="color:#24292E;--shiki-dark:#E06C75;"> arr</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">[</span><span style="color:#24292E;--shiki-dark:#E06C75;">i</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">], </span><span style="color:#005CC5;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">			}</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">			return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#005CC5;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">	iter</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> iterator</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">num</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">	for</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		value</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#24292E;--shiki-dark:#E06C75;">ok</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> iter</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">num</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">		if</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !</span><span style="color:#24292E;--shiki-dark:#E06C75;">ok</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">			return</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">		fmt</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">.</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;">Println</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">value</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">// 结果</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">//1</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">//2</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">//3</span></span>
<span class="line"><span style="color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic;">//4</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="回调函数" tabindex="-1"><a class="header-anchor" href="#回调函数"><span>回调函数</span></a></h2><p>我们也可以通过传参，实现传入回调函数</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> GetData</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">data</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">callback</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    go</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#E06C75;">        result</span><span style="color:#D73A49;--shiki-dark:#E5C07B;"> :=</span><span style="color:#24292E;--shiki-dark:#E06C75;"> data</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> +</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#6F42C1;--shiki-dark:#61AFEF;">        callback</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#24292E;--shiki-dark:#E06C75;">result</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面的例子可以看到， 我们传入 <code>data</code> 后， <code>callback</code> 可以获取到 <code>result</code> 进行额外回调操作。</p><h2 id="函数工厂" tabindex="-1"><a class="header-anchor" href="#函数工厂"><span>函数工厂</span></a></h2><p>通过闭包我们还可以构造函数工厂，通过传入参数返回对应函数。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="shiki shiki-themes github-light one-dark-pro vp-code" style="background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#6F42C1;--shiki-dark:#61AFEF;"> CalculationFactory</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">operation</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> string</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    switch</span><span style="color:#24292E;--shiki-dark:#E06C75;"> operation</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    case</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;add&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">       return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">          return</span><span style="color:#24292E;--shiki-dark:#E06C75;"> a</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> +</span><span style="color:#24292E;--shiki-dark:#E06C75;"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">       }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    case</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;subtract&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">       return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">          return</span><span style="color:#24292E;--shiki-dark:#E06C75;"> a</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> -</span><span style="color:#24292E;--shiki-dark:#E06C75;"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">       }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    case</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;multiply&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">       return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">          return</span><span style="color:#24292E;--shiki-dark:#E06C75;"> a</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> *</span><span style="color:#24292E;--shiki-dark:#E06C75;"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">       }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    case</span><span style="color:#032F62;--shiki-dark:#98C379;"> &quot;divide&quot;</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">       return</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> func</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">a</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">, </span><span style="color:#E36209;--shiki-dark:#E06C75;font-style:inherit;--shiki-dark-font-style:italic;">b</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="color:#D73A49;--shiki-dark:#C678DD;">int</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">          if</span><span style="color:#24292E;--shiki-dark:#E06C75;"> b</span><span style="color:#D73A49;--shiki-dark:#56B6C2;"> !=</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="color:#24292E;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">             return</span><span style="color:#24292E;--shiki-dark:#E06C75;"> a</span><span style="color:#D73A49;--shiki-dark:#C678DD;"> /</span><span style="color:#24292E;--shiki-dark:#E06C75;"> b</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">          }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">          return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">       }</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">    default</span><span style="color:#24292E;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#C678DD;">       return</span><span style="color:#005CC5;--shiki-dark:#D19A66;"> nil</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们可以传入 <code>add</code> 获取加法函数，<code>divide</code> 获取除法函数。</p>`,18),r=[e];function p(o,t){return n(),a("div",null,r)}const d=s(l,[["render",p],["__file","50-closure.html.vue"]]),h=JSON.parse('{"path":"/guide/concepts/golang/50-closure.html","title":"闭包","lang":"zh-CN","frontmatter":{"order":50,"title":"闭包","icon":"line-md:sun-rising-twotone-loop","head":[["meta",{"name":"keywords","content":"Go, Golang, closure, 闭包, 函数工厂, 迭代器, 中间件, 回调函数"}],["link",{"rel":"alternate","hreflang":"en-us","href":"https://goguide.ryansu.tech/en/guide/concepts/golang/50-closure.html"}],["meta",{"property":"og:url","content":"https://goguide.ryansu.tech/guide/concepts/golang/50-closure.html"}],["meta",{"property":"og:site_name","content":"Go 面试宝典"}],["meta",{"property":"og:title","content":"闭包"}],["meta",{"property":"og:description","content":"什么是闭包? 什么是闭包? 闭包是由函数和与其相关的引用环境组合而成的实体。简单来说，闭包就是一个引用了作用域之外的变量的函数（Func），该函数的存在时间可以超过创建他的作用域。 例子 我们会注意到 i 是 count 的局部变量，执行两次函数感觉上应该是都输出 1， 实际上输出的是 1， 2， 原因是在赋值时 count 保留着对 i 的指针，因此..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-05-21T12:50:27.000Z"}],["meta",{"property":"article:author","content":"Go Guide"}],["meta",{"property":"article:modified_time","content":"2024-05-21T12:50:27.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"闭包\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-21T12:50:27.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Go Guide\\",\\"url\\":\\"https://github.com/suyuan32\\"}]}"]],"description":"什么是闭包? 什么是闭包? 闭包是由函数和与其相关的引用环境组合而成的实体。简单来说，闭包就是一个引用了作用域之外的变量的函数（Func），该函数的存在时间可以超过创建他的作用域。 例子 我们会注意到 i 是 count 的局部变量，执行两次函数感觉上应该是都输出 1， 实际上输出的是 1， 2， 原因是在赋值时 count 保留着对 i 的指针，因此..."},"headers":[{"level":2,"title":"什么是闭包?","slug":"什么是闭包","link":"#什么是闭包","children":[]},{"level":2,"title":"使用场景","slug":"使用场景","link":"#使用场景","children":[{"level":3,"title":"中间件","slug":"中间件","link":"#中间件","children":[]}]},{"level":2,"title":"状态共享","slug":"状态共享","link":"#状态共享","children":[]},{"level":2,"title":"回调函数","slug":"回调函数","link":"#回调函数","children":[]},{"level":2,"title":"函数工厂","slug":"函数工厂","link":"#函数工厂","children":[]}],"git":{"createdTime":1716295827000,"updatedTime":1716295827000,"contributors":[{"name":"Ryan Su","email":"yuansu.china.work@gmail.com","commits":1}]},"readingTime":{"minutes":2.23,"words":669},"filePathRelative":"guide/concepts/golang/50-closure.md","localizedDate":"2024年5月21日","autoDesc":true,"excerpt":"<h2>什么是闭包?</h2>\\n<div class=\\"hint-container info\\">\\n<p class=\\"hint-container-title\\">什么是闭包?</p>\\n<p>闭包是由函数和与其相关的引用环境组合而成的实体。简单来说，闭包就是一个引用了作用域之外的变量的函数（Func），该函数的存在时间可以超过创建他的作用域。</p>\\n<p>例子</p>\\n<div class=\\"language-go line-numbers-mode\\" data-ext=\\"go\\" data-title=\\"go\\"><pre class=\\"shiki shiki-themes github-light one-dark-pro vp-code\\" style=\\"background-color:#fff;--shiki-dark-bg:#282c34;color:#24292e;--shiki-dark:#abb2bf\\" tabindex=\\"0\\"><code><span class=\\"line\\"><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">package</span><span style=\\"color:#6F42C1;--shiki-dark:#E5C07B\\"> main</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">import</span><span style=\\"color:#032F62;--shiki-dark:#98C379\\"> \\"</span><span style=\\"color:#6F42C1;--shiki-dark:#98C379\\">fmt</span><span style=\\"color:#032F62;--shiki-dark:#98C379\\">\\"</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">func</span><span style=\\"color:#6F42C1;--shiki-dark:#61AFEF\\"> main</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">() {</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#E06C75\\">\\tcount</span><span style=\\"color:#D73A49;--shiki-dark:#E5C07B\\"> :=</span><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\"> func</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">() </span><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">func</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">() </span><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">int</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#E06C75\\">\\t\\ti</span><span style=\\"color:#D73A49;--shiki-dark:#E5C07B\\"> :=</span><span style=\\"color:#005CC5;--shiki-dark:#D19A66\\"> 0</span><span style=\\"color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic\\"> // 初始化函数内变量</span></span>\\n<span class=\\"line\\"><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">\\t\\treturn</span><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\"> func</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">() </span><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">int</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#E06C75\\">\\t\\t\\ti</span><span style=\\"color:#D73A49;--shiki-dark:#56B6C2\\"> ++</span><span style=\\"color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic\\"> // 函数内变量加 1</span></span>\\n<span class=\\"line\\"><span style=\\"color:#D73A49;--shiki-dark:#C678DD\\">\\t\\t\\treturn</span><span style=\\"color:#24292E;--shiki-dark:#E06C75\\"> i</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">\\t\\t}</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">\\t}()</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#E06C75\\">\\tfmt</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">.</span><span style=\\"color:#6F42C1;--shiki-dark:#61AFEF\\">Println</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">(</span><span style=\\"color:#6F42C1;--shiki-dark:#61AFEF\\">count</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">())</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#E06C75\\">\\tfmt</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">.</span><span style=\\"color:#6F42C1;--shiki-dark:#61AFEF\\">Println</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">(</span><span style=\\"color:#6F42C1;--shiki-dark:#61AFEF\\">count</span><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">())</span></span>\\n<span class=\\"line\\"><span style=\\"color:#24292E;--shiki-dark:#ABB2BF\\">}</span></span>\\n<span class=\\"line\\"></span>\\n<span class=\\"line\\"><span style=\\"color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic\\">// 结果</span></span>\\n<span class=\\"line\\"><span style=\\"color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic\\">// 1</span></span>\\n<span class=\\"line\\"><span style=\\"color:#6A737D;--shiki-dark:#7F848E;font-style:inherit;--shiki-dark-font-style:italic\\">// 2</span></span></code></pre>\\n<div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div><p>我们会注意到 <code>i</code> 是 <code>count</code> 的局部变量，执行两次函数感觉上应该是都输出 <code>1</code>， 实际上输出的是 <code>1， 2</code>， 原因是在赋值时 <code>count</code> 保留着对 <code>i</code> 的指针，因此 <code>i</code> 在逃逸分析后被保留，没有随着函数的执行完毕而结束。<strong>如果函数没有赋值给变量，则执行多次结果会保持不变。</strong></p>\\n</div>"}');export{d as comp,h as data};
