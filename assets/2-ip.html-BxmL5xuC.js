import{_ as t}from"./comparing-ipv4-and-ipv6-headers-C3gbjVk-.js";import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as d,o as r,d as i}from"./app-DLqeUa4U.js";const n="/assets/image/article/network/ip_zh.png",l={},a=i('<h2 id="ip" tabindex="-1"><a class="header-anchor" href="#ip"><span>IP</span></a></h2><p>IP (Internet Protocol) 协议和 TCP 组成的 TCP/IP 协议栈是互联网的核心协议之一。</p><p>IP 协议有以下特点：</p><ul><li><strong>无状态</strong>： 不储存状态信息，意味着 IP 协议传递的数据包可能是无序的、重复的。</li><li><strong>无连接</strong>： 不需要建立连接，发送方和接收方都不需要存储对方的信息，每次发送都需要指定目标的 IP 地址。</li><li><strong>不可靠</strong>： IP 协议不能保证数据包一定能送达，可能会丢包，或者因超时而被丢弃。</li></ul><h3 id="ipv4-结构" tabindex="-1"><a class="header-anchor" href="#ipv4-结构"><span><strong>IPV4</strong> 结构</span></a></h3><figure><img src="'+n+'" alt="ipv4 header" tabindex="0" loading="lazy"><figcaption>ipv4 header</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">字段介绍</p><table><thead><tr><th>字段</th><th>描述</th></tr></thead><tbody><tr><td>版本</td><td>占用 4 bit，用来标识 IP 首部的版本号。IPv4 版本号是 4</td></tr><tr><td>首部长度</td><td>表示 IP 首部的大小，最小值为5 (5<em>4 = 20 byte)，最大值为 15 (15</em>4 = 60byte)</td></tr><tr><td>区分服务(DS)</td><td>用来表示服务的类型。可划分为 DSCP 和 ECN (显式拥塞通告)</td></tr><tr><td>总长度</td><td>表示的是 IP 首部与数据部分合起来的总字节数</td></tr><tr><td>标识</td><td>用于分片重组，分片时每产生一个数报文该字段就加1</td></tr><tr><td>标志</td><td>表示包被分片的相关信息</td></tr><tr><td>片偏移</td><td>用来标识被分片的每一个分段相对于原始数据的位置，单位为 <strong>8</strong> 字节</td></tr><tr><td>生存时间(TTL)</td><td>每经过一个路由器该字段就会减一，当为零的时候会被丢弃</td></tr><tr><td>协议</td><td>该报文数据区使用的协议</td></tr><tr><td>首部校验和</td><td>用于检测报文是否损坏</td></tr><tr><td>源地址</td><td>表示发送端的 IP 地址</td></tr><tr><td>目标地址</td><td>表示接收端的 IP 地址</td></tr><tr><td>选项</td><td>附加的信息</td></tr><tr><td>数据</td><td>传输的数据内容</td></tr></tbody></table></div><details class="hint-container details"><summary>版本对应数字列表</summary><table><thead><tr><th>版本</th><th>描述</th><th>状态</th></tr></thead><tbody><tr><td>0</td><td>互联网协议，v4 之前</td><td>保留</td></tr><tr><td>1–3</td><td>未分配</td><td></td></tr><tr><td>4</td><td>互联网协议版本 4 (IPv4)</td><td>活跃</td></tr><tr><td>5</td><td>互联网流协议或 ST</td><td>废弃</td></tr><tr><td>5</td><td>互联网流协议或 ST-II</td><td>废弃</td></tr><tr><td>6</td><td>简单互联网协议 (SIP)</td><td>废弃</td></tr><tr><td>6</td><td>互联网协议版本 6 (IPv6)</td><td>活跃</td></tr><tr><td>7</td><td>TP/IX 下一代互联网 (IPv7)</td><td>废弃</td></tr><tr><td>8</td><td>P 互联网协议 (PIP)</td><td>废弃</td></tr><tr><td>9</td><td>TCP 和 UDP 大地址 (TUBA)</td><td>废弃</td></tr><tr><td>10–14</td><td>未分配</td><td></td></tr><tr><td>15</td><td>版本字段标记值</td><td>保留</td></tr></tbody></table></details><details class="hint-container details"><summary>标志 (Flags) 介绍</summary><p>这个3位字段用于控制和识别分片，它们是：</p><table><thead><tr><th>位</th><th>描述</th></tr></thead><tbody><tr><td>0</td><td>保留，必须为0</td></tr><tr><td>1</td><td>禁止分片（Don’t Fragment，DF）</td></tr><tr><td>2</td><td>更多分片（More Fragment，MF）</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li><p><strong>如果DF标志位被设置为1，但路由要求必须分片报文，则此报文会被丢弃。</strong></p></li><li><p><strong>被分片的报文除了最后一个分片以外其他分片的 MF 标志位都为 1，且最后一个分片的分片偏移字段不为 0</strong></p></li></ul></div></details><details class="hint-container details"><summary>常见的 IP 选项有哪些？</summary><ul><li><p><strong>安全性选项（Security Options）</strong>：用于提供网络安全功能，例如数据加密、身份验证和访问控制。</p></li><li><p><strong>记录路由选项（Record Route Option）</strong>：启用IP数据报在传输路径上记录途经的路由器的IP地址，以便诊断网络问题或跟踪数据包的路径。</p></li><li><p><strong>宽松源站选路（Loose Source Routing）</strong>：指定数据包的传输路径，要求数据包经过指定的中间节点，但允许在路径上的其他节点进行一定的选择。</p></li><li><p><strong>严格源站选路（Strict Source Routing）</strong>：指定数据包的传输路径，要求数据包必须按照指定的节点顺序传递，其他节点不能参与。</p></li><li><p><strong>时间戳选项（Timestamp Option）</strong>：在数据包中插入时间戳信息，用于测量数据包从源到目的地传输所需的时间。</p></li></ul></details><h3 id="分片" tabindex="-1"><a class="header-anchor" href="#分片"><span>分片</span></a></h3><div class="hint-container tip"><p class="hint-container-title">MTU</p><p>最大传输单元 (MTU, Maximum Transmission Unit) 指的是在数据链路层能通过的最大数据包大小（单位： 字节）。</p></div><p>当 <code>IP</code> 数据包在链路层传输的时候，若数据包大于链路层的 <code>MTU</code>， 则需要对数据包进行分片。分片的长度需小于等于 MTU 减去 IP 首部长度。</p><div class="hint-container important"><p class="hint-container-title">分片过程</p><p>分片后的每一个数据分片都会放到独立的 IP 报文中，报文中的对应字段需要进行修改：</p><ul><li>修改总长字段为此时分片的长度</li><li>除了最后一片分片外，其他分片的更多分片（MF）标志位被设置为 1</li><li>调整分片偏移量</li><li>重新计算校验和</li></ul></div><details class="hint-container details"><summary>例子</summary><p>一个IP报文首部长度 <code>20</code> 字节且有 <code>4000</code> 字节的数据载荷（总长：<code>4020</code> 字节），在 <code>MTU</code> 为 <code>2500</code> 字节的链路上传输，他将被分割成两个分片：</p><table><thead><tr><th>总长</th><th>首部</th><th>数据</th><th>更多分片（MF）？</th><th>DF</th><th>分片偏移量</th></tr></thead><tbody><tr><td>2500</td><td>20</td><td>2480</td><td>是</td><td>0</td><td>0</td></tr><tr><td>1540</td><td>20</td><td>1520</td><td>否</td><td>0</td><td>310 （2480/8）</td></tr></tbody></table><p>同理，切割后的分片在 MTU 变小时会被再次切割。</p></details><h3 id="重组" tabindex="-1"><a class="header-anchor" href="#重组"><span>重组</span></a></h3><div class="hint-container tip"><p class="hint-container-title">如何判断数据已被分片?</p><ul><li>DF 标志位为 0</li><li>分片偏移字段不为 0</li></ul></div><p>接收者会将分片收集起来，并通过偏移量进行排序，一旦收集齐就会组装起来提交给上传协议栈。</p><h3 id="ipv6" tabindex="-1"><a class="header-anchor" href="#ipv6"><span>IPV6</span></a></h3><figure><img src="'+t+'" alt="IPV6" tabindex="0" loading="lazy"><figcaption>IPV6</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">IPV4 和 IPV6 区别</p><table><thead><tr><th style="text-align:left;">特性</th><th style="text-align:left;">IPv4</th><th style="text-align:left;">IPv6</th></tr></thead><tbody><tr><td style="text-align:left;"><strong>地址长度</strong></td><td style="text-align:left;">32位，提供约43亿个地址</td><td style="text-align:left;">128位，提供极大数量的地址</td></tr><tr><td style="text-align:left;"><strong>地址表示</strong></td><td style="text-align:left;">点分十进制表示法，例如：192.168.0.1</td><td style="text-align:left;">冒号十六进制表示法，例如：2001:0db8:85a3:0000:0000:8a2e:0370:7334</td></tr><tr><td style="text-align:left;"><strong>头部长度</strong></td><td style="text-align:left;">固定，20字节</td><td style="text-align:left;">固定，40字节</td></tr><tr><td style="text-align:left;"><strong>服务质量（QoS）</strong></td><td style="text-align:left;">原生支持有限</td><td style="text-align:left;">原生支持，包括流标签和流优先级</td></tr><tr><td style="text-align:left;"><strong>安全性</strong></td><td style="text-align:left;">需要使用 IPSec</td><td style="text-align:left;">原生支持 IPSec</td></tr><tr><td style="text-align:left;"><strong>配置</strong></td><td style="text-align:left;">手动或 DHCP</td><td style="text-align:left;">手动，自动（基于链接的本地地址和路由公告）或 DHCPv6</td></tr></tbody></table></div><h3 id="什么是-ip-欺骗" tabindex="-1"><a class="header-anchor" href="#什么是-ip-欺骗"><span>什么是 IP 欺骗？</span></a></h3><p>IP 欺骗技术指的是伪造某台主机的 IP 地址，攻击者可以向服务器发送大量 RST 标志位的不同IP 的数据段，使得服务器和主机的连接断开，若其他主机需要访问服务器，则需要重新建立连接。或者伪装成其他主机和服务器建立连接，窃取数据。</p>',23),o=[a];function s(p,c){return r(),d("div",null,o)}const m=e(l,[["render",s],["__file","2-ip.html.vue"]]),I=JSON.parse('{"path":"/guide/concepts/network/2-ip.html","title":"IP","lang":"zh-CN","frontmatter":{"order":2,"title":"IP","icon":"line-md:star-filled","head":[["meta",{"name":"keywords","content":"IP, Internet Protocol, TCP/IP, IPV4, IPV6"}],["link",{"rel":"alternate","hreflang":"en-us","href":"https://goguide.ryansu.tech/en/guide/concepts/network/2-ip.html"}],["meta",{"property":"og:url","content":"https://goguide.ryansu.tech/guide/concepts/network/2-ip.html"}],["meta",{"property":"og:site_name","content":"Go 面试宝典"}],["meta",{"property":"og:title","content":"IP"}],["meta",{"property":"og:description","content":"IP IP (Internet Protocol) 协议和 TCP 组成的 TCP/IP 协议栈是互联网的核心协议之一。 IP 协议有以下特点： 无状态： 不储存状态信息，意味着 IP 协议传递的数据包可能是无序的、重复的。 无连接： 不需要建立连接，发送方和接收方都不需要存储对方的信息，每次发送都需要指定目标的 IP 地址。 不可靠： IP 协议不能..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://goguide.ryansu.tech/assets/image/article/network/ip_zh.png"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-05-05T13:24:21.000Z"}],["meta",{"property":"article:author","content":"Go Guide"}],["meta",{"property":"article:modified_time","content":"2024-05-05T13:24:21.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"IP\\",\\"image\\":[\\"https://goguide.ryansu.tech/assets/image/article/network/ip_zh.png\\",\\"https://goguide.ryansu.tech/assets/image/article/network/comparing-ipv4-and-ipv6-headers.png\\"],\\"dateModified\\":\\"2024-05-05T13:24:21.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Go Guide\\",\\"url\\":\\"https://github.com/suyuan32\\"}]}"]],"description":"IP IP (Internet Protocol) 协议和 TCP 组成的 TCP/IP 协议栈是互联网的核心协议之一。 IP 协议有以下特点： 无状态： 不储存状态信息，意味着 IP 协议传递的数据包可能是无序的、重复的。 无连接： 不需要建立连接，发送方和接收方都不需要存储对方的信息，每次发送都需要指定目标的 IP 地址。 不可靠： IP 协议不能..."},"headers":[{"level":2,"title":"IP","slug":"ip","link":"#ip","children":[{"level":3,"title":"IPV4 结构","slug":"ipv4-结构","link":"#ipv4-结构","children":[]},{"level":3,"title":"分片","slug":"分片","link":"#分片","children":[]},{"level":3,"title":"重组","slug":"重组","link":"#重组","children":[]},{"level":3,"title":"IPV6","slug":"ipv6","link":"#ipv6","children":[]},{"level":3,"title":"什么是 IP 欺骗？","slug":"什么是-ip-欺骗","link":"#什么是-ip-欺骗","children":[]}]}],"git":{"createdTime":1708140037000,"updatedTime":1714915461000,"contributors":[{"name":"Ryan Su","email":"yuansu.china.work@gmail.com","commits":4}]},"readingTime":{"minutes":5.17,"words":1551},"filePathRelative":"guide/concepts/network/2-ip.md","localizedDate":"2024年2月17日","autoDesc":true,"excerpt":"<h2>IP</h2>\\n<p>IP (Internet Protocol) 协议和 TCP 组成的 TCP/IP 协议栈是互联网的核心协议之一。</p>\\n<p>IP 协议有以下特点：</p>\\n<ul>\\n<li><strong>无状态</strong>： 不储存状态信息，意味着 IP 协议传递的数据包可能是无序的、重复的。</li>\\n<li><strong>无连接</strong>： 不需要建立连接，发送方和接收方都不需要存储对方的信息，每次发送都需要指定目标的 IP 地址。</li>\\n<li><strong>不可靠</strong>： IP 协议不能保证数据包一定能送达，可能会丢包，或者因超时而被丢弃。</li>\\n</ul>"}');export{m as comp,I as data};
