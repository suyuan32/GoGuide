import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{o as s,c as a,e as t}from"./app-CkDemfCU.js";const e={},o=t(`<h2 id="互斥锁-mutex" tabindex="-1"><a class="header-anchor" href="#互斥锁-mutex"><span>互斥锁 (Mutex)</span></a></h2><p>互斥锁是一种最基本的锁，它的作用是保证在同一时刻只有一个 goroutine 可以访问共享资源。在 Go 语言中，互斥锁由 <code>sync</code> 包提供，使用 <code>syns.Mutex</code> 结构体来表示。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// 初始化互斥锁</span>
mu <span class="token operator">:=</span> sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 上锁</span>
mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 解锁</span>
mu<span class="token punctuation">.</span><span class="token function">UnLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><details class="hint-container details"><summary>例子</summary><p>由于 map 无法支持并发读写，我们可以添加互斥锁使其实现并发读写</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// SafeMap 可以并发安全地使用。</span>
<span class="token keyword">type</span> SafeMap <span class="token keyword">struct</span> <span class="token punctuation">{</span>
	mu sync<span class="token punctuation">.</span>Mutex
	v  <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// Increase 增加给定键的计数器。</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SafeMap<span class="token punctuation">)</span> <span class="token function">Increase</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 锁定，以便一次只有一个 Goroutine 可以访问映射 s.v。</span>
	s<span class="token punctuation">.</span>v<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token operator">++</span>
	s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// Value 返回给定键的计数器的当前值。</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>SafeMap<span class="token punctuation">)</span> <span class="token function">Value</span><span class="token punctuation">(</span>key <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span>
	s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 锁定，以便一次只有一个 Goroutine 可以访问映射 s.v。</span>
	<span class="token keyword">defer</span> s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> s<span class="token punctuation">.</span>v<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	s <span class="token operator">:=</span> SafeMap<span class="token punctuation">{</span>v<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span><span class="token punctuation">}</span>
	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
		<span class="token keyword">go</span> s<span class="token punctuation">.</span><span class="token function">Increase</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>

	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 结果</span>
<span class="token comment">// 1000</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li><code>Lock()</code> 后如果再次执行 <code>Lock()</code> 第二个 <code>Lock()</code> 会阻塞，造成死锁，导致异常退出</li><li>如果没有 <code>Lock()</code> 却执行 <code>UnLock()</code> 则会触发 <code>panic</code> ，导致异常退出</li><li><strong>互斥锁的性能开销较大，因为每次加锁和解锁都需要调用系统内核函数，所以在性能要求较高的场景下，可以考虑使用读写锁</strong></li></ul></div><h2 id="读写锁-rwmutex" tabindex="-1"><a class="header-anchor" href="#读写锁-rwmutex"><span>读写锁 (RWMutex)</span></a></h2><p>读写锁是一种特殊的锁，它分为读锁和写锁。读锁可以被多个 goroutine 同时持有，但是写锁只能被一个 goroutine 持有。在 Go 语言中，读写锁由 <code>sync</code> 包提供，使用 <code>sync.RWMutex</code> 结构体来表示。</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// 初始化读写锁</span>
rw <span class="token operator">:=</span> sync<span class="token punctuation">.</span>RWMutex<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 读锁</span>
rw<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 读解锁</span>
rw<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 写锁</span>
rw<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// 写解锁</span>
rw<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">读者-写者问题</p><ul><li><strong>读者优先 （readers-preference）</strong><ul><li>读者优先指的是读的操作优先于写的操作，当有读操作时，写操作会被阻塞，但是读操作不会被阻塞。只有所有的读者都释放了读锁，写操作才能进行。</li></ul></li><li><strong>写者优先 （writers-preference）</strong><ul><li>写者优先指的是写的操作优先于读的操作，当有写操作时，当前的读者可以继续进行读操作，但是不允许新的读者进行读操作，当前读者完成读取操作后，写者会进行写入操作，只有写者完成写入操作后，新的读者才能进行读操作。</li></ul></li></ul><div class="hint-container warning"><p class="hint-container-title">注意</p><ul><li>读者优先在频繁读取的系统中会导致写者长时间阻塞导致<strong>写饥饿</strong></li><li>写者优先在频繁写入的系统中会导致读者长时间阻塞导致<strong>读饥饿</strong></li><li><strong>Golang 的 <code>sync.RWMutex</code> 是写者优先的，优先处理写的操作</strong></li></ul></div></div><details class="hint-container details"><summary>例子</summary><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
	<span class="token string">&quot;fmt&quot;</span>
	<span class="token string">&quot;sync&quot;</span>
	<span class="token string">&quot;time&quot;</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	lock <span class="token operator">:=</span> sync<span class="token punctuation">.</span>RWMutex<span class="token punctuation">{</span><span class="token punctuation">}</span>

	<span class="token keyword">go</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">Write</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>
	<span class="token keyword">go</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>lock<span class="token punctuation">)</span>

	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Read</span><span class="token punctuation">(</span>lock <span class="token operator">*</span>sync<span class="token punctuation">.</span>RWMutex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	lock<span class="token punctuation">.</span><span class="token function">RLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Read lock at&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Read at &quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	lock<span class="token punctuation">.</span><span class="token function">RUnlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Read unlock at&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Write</span><span class="token punctuation">(</span>lock <span class="token operator">*</span>sync<span class="token punctuation">.</span>RWMutex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Write lock at&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Write at &quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Write unlock at&quot;</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结果</span>
<span class="token comment">// Read lock at 2024-05-05 09:27:15.045784 +0800 CST m=+0.001017301</span>
<span class="token comment">// Read at  2024-05-05 09:27:16.0654976 +0800 CST m=+1.020730901</span>
<span class="token comment">// Read unlock at 2024-05-05 09:27:16.0654976 +0800 CST m=+1.020730901</span>
<span class="token comment">// Write lock at 2024-05-05 09:27:16.0654976 +0800 CST m=+1.020730901</span>
<span class="token comment">// Write at  2024-05-05 09:27:17.0774968 +0800 CST m=+2.032730101</span>
<span class="token comment">// Write unlock at 2024-05-05 09:27:17.0774968 +0800 CST m=+2.032730101</span>
<span class="token comment">// Read lock at 2024-05-05 09:27:17.0774968 +0800 CST m=+2.032730101</span>
<span class="token comment">// Read lock at 2024-05-05 09:27:17.0777343 +0800 CST m=+2.032967601</span>
<span class="token comment">// Read lock at 2024-05-05 09:27:17.0777343 +0800 CST m=+2.032967601</span>
<span class="token comment">// Read lock at 2024-05-05 09:27:17.0777343 +0800 CST m=+2.032967601</span>
<span class="token comment">// Read at  2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read unlock at 2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read at  2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read unlock at 2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read at  2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read unlock at 2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read at  2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Read unlock at 2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Write lock at 2024-05-05 09:27:18.0778894 +0800 CST m=+3.033122701</span>
<span class="token comment">// Write at  2024-05-05 09:27:19.087953 +0800 CST m=+4.043186301</span>
<span class="token comment">// Write unlock at 2024-05-05 09:27:19.087953 +0800 CST m=+4.043186301</span>
<span class="token comment">// Write lock at 2024-05-05 09:27:19.087953 +0800 CST m=+4.043186301</span>
<span class="token comment">// Write at  2024-05-05 09:27:20.0995559 +0800 CST m=+5.054789201</span>
<span class="token comment">// Write unlock at 2024-05-05 09:27:20.0995559 +0800 CST m=+5.054789201</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到写者优先的特性，写者优先处理写的操作，第一次 <code>Read</code> 读取后 <code>Write</code> 是第三个执行，却在第二个就执行，原因是第二个 <code>Read</code> 在获取读取锁时有写入锁的操作，优先处理了写入锁，因此第二个 <code>Read</code> 在第三个 <code>Write</code> 之后才执行。 我们还可以看到可以同时执行多个 <code>Read</code> 操作，但是只能同时执行一个 <code>Write</code> 操作。</p></details><div class="hint-container warning"><p class="hint-container-title">RWLock 使用注意</p><ul><li><code>Lock</code> 和 <code>Unlock</code>, <code>RLock()</code>和<code>RUnlock()</code> 必须成对出现，否则会导致死锁</li><li><code>Lock</code> 不能同时执行两次，会导致死锁</li><li><code>RWLock</code> 在传参时必须使用指针传递，不能使用值传递副本</li><li><code>RWLock</code> 是不可重入锁</li></ul></div>`,11),c=[o];function p(i,l){return s(),a("div",null,c)}const k=n(e,[["render",p],["__file","22-lock.html.vue"]]),r=JSON.parse('{"path":"/guide/concepts/golang/22-lock.html","title":"锁","lang":"zh-CN","frontmatter":{"order":22,"title":"锁","icon":"line-md:sunny-filled-loop-to-moon-filled-loop-transition","head":[["meta",{"name":"keywords","content":"Go, Golang, 锁，Lock, 互斥锁，读写锁，sync"}],["link",{"rel":"alternate","hreflang":"en-us","href":"https://goguide.ryansu.tech/en/guide/concepts/golang/22-lock.html"}],["meta",{"property":"og:url","content":"https://goguide.ryansu.tech/guide/concepts/golang/22-lock.html"}],["meta",{"property":"og:site_name","content":"Go 面试宝典"}],["meta",{"property":"og:title","content":"锁"}],["meta",{"property":"og:description","content":"互斥锁 (Mutex) 互斥锁是一种最基本的锁，它的作用是保证在同一时刻只有一个 goroutine 可以访问共享资源。在 Go 语言中，互斥锁由 sync 包提供，使用 syns.Mutex 结构体来表示。 例子 由于 map 无法支持并发读写，我们可以添加互斥锁使其实现并发读写 注意 Lock() 后如果再次执行 Lock() 第二个 Lock()..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:locale:alternate","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-05-05T02:36:13.000Z"}],["meta",{"property":"article:author","content":"Go Guide"}],["meta",{"property":"article:modified_time","content":"2024-05-05T02:36:13.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"锁\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-05-05T02:36:13.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Go Guide\\",\\"url\\":\\"https://github.com/suyuan32\\"}]}"]],"description":"互斥锁 (Mutex) 互斥锁是一种最基本的锁，它的作用是保证在同一时刻只有一个 goroutine 可以访问共享资源。在 Go 语言中，互斥锁由 sync 包提供，使用 syns.Mutex 结构体来表示。 例子 由于 map 无法支持并发读写，我们可以添加互斥锁使其实现并发读写 注意 Lock() 后如果再次执行 Lock() 第二个 Lock()..."},"headers":[{"level":2,"title":"互斥锁 (Mutex)","slug":"互斥锁-mutex","link":"#互斥锁-mutex","children":[]},{"level":2,"title":"读写锁 (RWMutex)","slug":"读写锁-rwmutex","link":"#读写锁-rwmutex","children":[]}],"git":{"createdTime":1714876573000,"updatedTime":1714876573000,"contributors":[{"name":"Ryan Su","email":"yuansu.china.work@gmail.com","commits":1}]},"readingTime":{"minutes":4.43,"words":1329},"filePathRelative":"guide/concepts/golang/22-lock.md","localizedDate":"2024年5月5日","autoDesc":true,"excerpt":"<h2>互斥锁 (Mutex)</h2>\\n<p>互斥锁是一种最基本的锁，它的作用是保证在同一时刻只有一个 goroutine 可以访问共享资源。在 Go 语言中，互斥锁由 <code>sync</code> 包提供，使用 <code>syns.Mutex</code> 结构体来表示。</p>\\n<div class=\\"language-go\\" data-ext=\\"go\\" data-title=\\"go\\"><pre class=\\"language-go\\"><code><span class=\\"token comment\\">// 初始化互斥锁</span>\\nmu <span class=\\"token operator\\">:=</span> sync<span class=\\"token punctuation\\">.</span>Mutex<span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>\\n\\n<span class=\\"token comment\\">// 上锁</span>\\nmu<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">Lock</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n\\n<span class=\\"token comment\\">// 解锁</span>\\nmu<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">UnLock</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span>\\n</code></pre></div>"}');export{k as comp,r as data};
